@{
    ViewData["Title"] = "调试页面";
    var debugInfo = ViewBag.DebugInfo;
    var allMenuItems = ViewBag.AllMenuItems as List<CampusCafeOrderingSystem.Models.MenuItem>;
    var vendorMenuItems = ViewBag.VendorMenuItems as List<CampusCafeOrderingSystem.Models.MenuItem>;
}

<div class="container mt-4">
    <h2>用户调试信息</h2>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">身份验证状态</h5>
            <p><strong>是否已认证:</strong> @(User.Identity?.IsAuthenticated ?? false)</p>
            <p><strong>用户名:</strong> @(User.Identity?.Name ?? "未登录")</p>
            <p><strong>邮箱:</strong> @(User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value ?? "无")</p>
            
            <h6 class="mt-3">用户角色:</h6>
            @if (User.Claims.Any(c => c.Type == System.Security.Claims.ClaimTypes.Role))
            {
                <ul>
                    @foreach (var role in User.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Role))
                    {
                        <li>@role.Value</li>
                    }
                </ul>
            }
            else
            {
                <p>无角色</p>
            }
            
            <h6 class="mt-3">所有声明:</h6>
            @if (User.Claims.Any())
            {
                <ul>
                    @foreach (var claim in User.Claims)
                    {
                        <li><strong>@claim.Type:</strong> @claim.Value</li>
                    }
                </ul>
            }
            else
            {
                <p>无声明</p>
            }
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">数据库菜单数据</h5>
            <p><strong>数据库中总菜单项数:</strong> @ViewBag.TotalMenuItems</p>
            <p><strong>当前用户的菜单项数:</strong> @ViewBag.VendorMenuItemsCount</p>
            
            @if (allMenuItems != null && allMenuItems.Any())
            {
                <h6 class="mt-3">所有菜单项:</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>名称</th>
                                <th>商家邮箱</th>
                                <th>分类</th>
                                <th>价格</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in allMenuItems.Take(10))
                            {
                                <tr>
                                    <td>@item.Id</td>
                                    <td>@item.Name</td>
                                    <td>@item.VendorEmail</td>
                                    <td>@item.Category</td>
                                    <td>¥@item.Price</td>
                                    <td>@(item.IsAvailable ? "可用" : "不可用")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @if (allMenuItems.Count > 10)
                    {
                        <p class="text-muted">显示前10项，总共@allMenuItems.Count项</p>
                    }
                </div>
            }
            else
            {
                <p class="text-warning">数据库中没有菜单数据</p>
            }
            
            @if (vendorMenuItems != null && vendorMenuItems.Any())
            {
                <h6 class="mt-3">当前用户的菜单项:</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>名称</th>
                                <th>分类</th>
                                <th>价格</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in vendorMenuItems)
                            {
                                <tr>
                                    <td>@item.Id</td>
                                    <td>@item.Name</td>
                                    <td>@item.Category</td>
                                    <td>¥@item.Price</td>
                                    <td>@(item.IsAvailable ? "可用" : "不可用")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-warning">当前用户没有菜单数据</p>
            }
        </div>
    </div>
    
    <div class="mt-3">
        <a href="/Merchant/MenuManagement" class="btn btn-primary">返回菜单管理</a>
        <a href="/Account/Login" class="btn btn-secondary">登录</a>
        <a href="/Account/Logout" class="btn btn-danger">注销</a>
    </div>
</div>