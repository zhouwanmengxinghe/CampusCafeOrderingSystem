@{
    ViewData["Title"] = "Debug Page";
    var debugInfo = ViewBag.DebugInfo;
    var allMenuItems = ViewBag.AllMenuItems as List<CampusCafeOrderingSystem.Models.MenuItem>;
    var vendorMenuItems = ViewBag.VendorMenuItems as List<CampusCafeOrderingSystem.Models.MenuItem>;
}

<div class="container mt-4">
    <h2>User Debug Information</h2>
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Authentication Status</h5>
            <p><strong>Is Authenticated:</strong> @(User.Identity?.IsAuthenticated ?? false)</p>
            <p><strong>Username:</strong> @(User.Identity?.Name ?? "Not logged in")</p>
            <p><strong>Email:</strong> @(User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value ?? "None")</p>
            
            <h6 class="mt-3">User Roles:</h6>
            @if (User.Claims.Any(c => c.Type == System.Security.Claims.ClaimTypes.Role))
            {
                <ul>
                    @foreach (var role in User.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Role))
                    {
                        <li>@role.Value</li>
                    }
                </ul>
            }
            else
            {
                <p>No roles</p>
            }
            
            <h6 class="mt-3">All Claims:</h6>
            @if (User.Claims.Any())
            {
                <ul>
                    @foreach (var claim in User.Claims)
                    {
                        <li><strong>@claim.Type:</strong> @claim.Value</li>
                    }
                </ul>
            }
            else
            {
                <p>No claims</p>
            }
        </div>
    }
    
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Database Menu Data</h5>
            <p><strong>Database Menu Items:</strong> @ViewBag.TotalMenuItems</p>
            <p><strong>Current Users Menu Items:</strong> @ViewBag.VendorMenuItemsCount</p>
            
            @if (allMenuItems != null && allMenuItems.Any())
            {
                <h6 class="mt-3">All Menu Items:</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Vendor Email</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in allMenuItems.Take(10))
                            {
                                <tr>
                                    <td>@item.Id</td>
                                    <td>@item.Name</td>
                                    <td>@item.VendorEmail</td>
                                    <td>@item.Category</td>
                                    <td>¥@item.Price</td>
                                    <td>@(item.IsAvailable ? "Available" : "Unavailable")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    @if (allMenuItems.Count > 10)
                    {
                        <p class="text-muted">Showing first 10 items, total @allMenuItems.Count items</p>
                    }
                </div>
            }
            else
            {
                <p class="text-warning">No menu data in database</p>
            }
            
            @if (vendorMenuItems != null && vendorMenuItems.Any())
            {
                <h6 class="mt-3">Current Users Menu Items:</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in vendorMenuItems)
                            {
                                <tr>
                                    <td>@item.Id</td>
                                    <td>@item.Name</td>
                                    <td>@item.Category</td>
                                    <td>¥@item.Price</td>
                                    <td>@(item.IsAvailable ? "Available" : "Unavailable")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-warning">Current user has no menu data</p>
            }
        </div>
    </div>
    
    <div class="mt-3">
        <a href="/Merchant/MenuManagement" class="btn btn-primary">Back to Menu Management</a>
        <a href="/Account/Login" class="btn btn-secondary">Login</a>
        <a href="/Account/Logout" class="btn btn-danger">Logout</a>
    </div>
</div>